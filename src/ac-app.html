<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="ac-sizeview.html">
<link rel="import" href="ac-avatar.html">
<link rel="import" href="ac-balance.html">
<link rel="import" href="ac-vault.html">
<link rel="import" href="ac-config.html">
<link rel="import" href="ac-web3.html">
<link rel="import" href="ac-profile.html">
<link rel="import" href="ac-preferences.html">
<link rel="import" href="ac-walletview.html">
<link rel="import" href="ac-intro.html">
<link rel="import" href="ac-home.html">
<link rel="import" href="ac-swtconversion.html">

<link rel="import" href="sc-hashtaglist.html">
<link rel="import" href="sc-hashtag.html">
<link rel="import" href="sc-itemdetail.html">
<link rel="import" href="sc-newitem.html">


<dom-module id="ac-app">
  <template>
    <style>
  :host {
    display: block;
    margin: 0px;
    padding: 0px;
    width: 100%;
    height: 100vh;
  }

  neon-animated-pages {
    height: 100%;
  }

  ac-createwallet {
    width: 100%;
    height: 100vh;
  }

  ac-vault {
    width: 100vw;
    height: 100vh;
  }

  ac-walletview {
    width: 100vw;
    height: 100vh;
  }


  </style>
<!-- <div class$="{{sizeview}}"> -->
    <!-- app-location binds with the URL and produces a route for
    app-route elements to consume. -->
    <app-location route="{{route}}" use-hash-as-path></app-location>
    <ac-sizeview sizeview="{{sizeview}}"></ac-sizeview>

    <!-- app-routes parse route paths based on the their `pattern`.
    Parameters are extracted into the `data` object. The rest of the path that
    comes after the `pattern` is put into the `tail` object, which can be
    passed to the `route` property of downstream app-routes. -->
    <app-route route="{{route}}" pattern="/:page" data="{{data}}" tail="{{pageTail}}"></app-route>
<!--     <app-route route="{{route}}" pattern="/vault" data="{{data}}" tail="{{vaultTail}}"></app-route>
 -->    <!--     <app-route route="{{route}}" pattern="/video" tail="{{videoTail}}" active="{{videoPageActive}}"></app-route>
  -->

  <ac-config web3host="{{web3host}}"></ac-config>

  <ac-web3 host="{{web3host}}" web3="{{web3}}" keystore="[[keystore]]"></ac-web3>

  <neon-animated-pages id="homepages" attr-for-selected="data-page" selected="[[data.page]]">

    <ac-swtconversion
      data-page="swt"
      route="[[pageTail]]"
      keystore="[[keystore]]"
      web3="[[web3]]"
      account="[[account]]"
      on-exit="toHome"
      >
    </ac-swtconversion>

    <ac-intro
      data-page="intro"
      on-newvault="createNewVault"
      on-importfile="toimportfile"
      on-importpk="toimportpk"
      on-externalpk="toexternalpk"
      on-enter="enter"  
      route="[[pageTail]]"
      sizeview="{{sizeview}}"
      >
    </ac-intro>

    <ac-vault
      id="thevault"
      data-page="vault"
      route="[[pageTail]]"
      currentkeystore="{{keystore}}"
      currentidentity="{{identity}}"
      currentaccount="{{account}}"
      on-unlocked="vaultUnlocked"
      on-locked="vaultLocked"
      on-novault="noVault"
      on-backupexit="toProfile"
      sizeview="{{sizeview}}"
      on-exit="reset"
      >
    </ac-vault>

    <ac-home
      data-page="home"
      keystore="[[keystore]]"
      identity="[[identity]]"
      web3="[[web3]]"
      pubkey="[[account]]"
      on-to-profile="toProfile"
      on-to-walletview="toWalletview"

      on-to-hashtaglist="toHashtaglist"

      on-to-hashtag="toHashtag"
      sizeview="{{sizeview}}">
    </ac-home>


    <ac-profile
      data-page="profile"
      id="profile"
      identity="[[identity]]"
      pubkey="[[account]]"
      on-exit="toHome"
      on-identity-update="saveIdentity"
      on-backup="toBackup"
      on-logout="logout"
      on-deletevault="deletevault"
      sizeview="{{sizeview}}">
    </ac-profile>

    <ac-walletview
      data-page="walletview"
      id="walletview"
      keystore="[[keystore]]"
      identity="[[identity]]"
      account="[[account]]"
      on-exit="toHome"
      sizeview="{{sizeview}}">
    </ac-walletview>

<!--     <sc-hashtaglist
      data-page="hashtaglist"
      id="hashtaglist"
      identity="[[identity]]"
      pubkey="[[account]]"
      on-exit="toHome"
      on-to-hashtag="toHashtag">
    </sc-hashtaglist> -->

    <sc-hashtag
      data-page="hashtag"
      id="hashtag"
      keystore="[[keystore]]"
      identity="[[identity]]"
      pubkey="[[account]]"
      on-exit="toHome"
      on-to-itemdetail="toItemdetail"
      on-to-newitem="toNewitem"
      currenthasht="{{currenthasht}}">
    </sc-hashtag>


    <sc-itemdetail
      data-page="itemdetail"
      identity="[[identity]]"
      pubkey="[[account]]"
      on-back="backtoHashtag"
      on-exit="toHome"
      on-to-hashtag="toHashtag"
      currenthasht="{{currenthasht}}">
    </sc-itemdetail>



    <sc-newitem
      data-page="newitem"
      identity="[[identity]]"
      pubkey="[[account]]"
      on-back="backtoHashtag"
      on-exit="toHome"
      on-to-hashtag="toHashtag"
      currenthasht="{{currenthasht}}">
    </sc-newitem>

</neon-animated-pages>
</template>

<script>
    Polymer({
      is: 'ac-app',

      properties: {

        sizeview: {
          type: String
         },
      },

      observers: [
        '_onRoutePathChanged(route.path)'
      ],

      _onRoutePathChanged: function(path) {
         console.log('ac-app -> _onRoutePathChanged',this.route,this.pageTail);
         // We need to check if we have a passwd in sessionstorage.
      },

      enter: function(){
        this.$.thevault.activate();
      },

      reset: function(){
        this.transitionto('/intro/welcome');
      },

      vaultUnlocked: function(){
        this.transitionto('/home');
      },

      vaultLocked: function(){
        this.transitionto('/vault/unlock');
      },

      noVault: function(){
        this.transitionto('/intro/newuser');
      },

      createNewVault: function(){
        this.transitionto('/vault/createnew');
      },

      toimportpk: function(){
        this.transitionto('/vault/importpk');
      },

      toexternalpk: function(){
        this.transitionto('/vault/externalpk');
      },


      toimportfile: function(){
        this.transitionto('/vault/importfile');
      },

      transitionto: function(target){
        console.log('ac-app -> transitionTo',target);
        this.set('route.path',target);
      },

      ready: function() {

      },

      attached: function() {
         this.transitionto('/intro/welcome');
          //this.$.thevault.activate();
          //console.log("OP APP...............",this.sizeview);
      },

      toWallet: function() {
        this.transitionto('/wallet');
      },

      logout: function() {
        this.$.thevault.closeVault();
        this.transitionto('/vault/unlock');
      },

      deletevault: function(){
        this.$.thevault.deleteVault();
        this.transitionto('/intro/welcome');
      },

      toHome: function() {
        this.transitionto('/home');
      },

      toItemdetail: function() {
        this.transitionto('/itemdetail');
      },

      toBackup: function() {
        this.transitionto('/vault/backup');
      },


      toProfile: function() {
        this.$.profile.init(function(){
        this.transitionto('/profile');
        }.bind(this));
      },

      toHashtaglist: function() {
        this.transitionto('/hashtaglist');
      },
      toHashtag: function(e) {
        this.currenthasht = e.detail;
        this.transitionto('/hashtag');
      },

      backtoHashtag: function() {
        this.transitionto('/hashtag');
      },

      toNewitem: function() {
        this.transitionto('/newitem');
      },

      toWalletview: function() {
        this.transitionto('/walletview');
      },

      saveIdentity: function(e) {
        this.identity = e.detail;
        this.$.thevault.saveVault();
      },

    });
  </script>

</dom-module>
