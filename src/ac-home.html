<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">

<!-- <link rel="import" href="../bower_components/ac-style/ac-style.html">
<link rel="import" href="../bower_components/ac-button/ac-button.html">
<link rel="import" href="../bower_components/ac-icon/ac-icon.html">
<link rel="import" href="../bower_components/ac-input/ac-input.html"> -->

<link rel="import" href="ac-sizeview.html">
<link rel="import" href="ac-wallet.html">
<link rel="import" href="ac-avatar.html">
<link rel="import" href="ac-ipfsupload.html">
<link rel="import" href="ac-ipfs.html">
<link rel="import" href="ac-shortcode.html">
<link rel="import" href="ac-tokentransfer.html">
<link rel="import" href="ac-spinner.html">
<link rel="import" href="sc-notification.html">
<link rel="import" href="sc-hashtaglist.html">


<link rel="import" href="../bower_components/sc-style/sc-style.html">
<link rel="import" href="../bower_components/sc-iconset/sc-iconset.html">

<link rel="stylesheet" href="../bower_components/Croppie/croppie.css" />
<script src="../bower_components/Croppie/croppie.js"></script>

<dom-module id="ac-home">
<link rel="import" href="../bower_components/sc-style/sc-style.css"  type="css">

  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
  :host {
    display: block;
    width: 100%;
/*    height: 100vh;*/
    /*background: var(--sc-grey1);*/
    /*@apply(--base-structure);*/
  }

    .homebalanceandavatar {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      @apply(--layout-start-justified);
      @apply(--layout-wrap);
      box-sizing:border-box;
      padding: 14vh 10vw 12vh 10vw;
      /*height: 42%;*/

    }

    #homecontent {
      width: 100%;
      box-sizing: border-box;
      padding: 0vh 10vw 10vh 10vw;
      /*height: 85vh;*/
    }

    .homebalancebox {
      /*height: 35vh;*/
/*      width: 100%;*/
      box-sizing: border-box;
        /*padding: 0px 0px 30px 3.5vw;*/
        padding: 0px 0px 0px 0px;
      @apply(--layout-vertical);
      @apply(--layout-start);
      @apply(--layout-start-justified);
/*      @apply(--layout-flex);*/

    }
    .toptoolbar {
      width: 100%;
      box-sizing: border-box;
      padding: 0px 0px 16px 10vw;
      height: 16vh;
      background-color: var(--ac-base);
      z-index: 3;
      @apply(--layout-horizontal);
      @apply(--layout-end);
    }

    .ac-avatar-box {
      @apply(--layout-vertical);
      @apply(--layout-center-center);
/*      @apply(--layout-center-justified);*/
      box-sizing: border-box;
      padding: 0px;
      margin: 0px 45px 0px 0px;
      z-index: 9;
    }



    .ac-username {
      margin: 0px 0px 0px 2px;
      width: 80%;
      max-width: 500px;
      text-align: left;

    }
    .arcbalance {
      height: 100%;
       margin-bottom: 0px;

    }

    .tokentrans {
      width: 100%;
      margin-top: 3vh;
    }

    .toridesharebtn {
      padding-top: 10px;
      padding-bottom: 13px;
      /*padding: 26px 38px 26px 38px;*/
      @apply(--base-shadow-and-inset);
      /*width: 80%;
      max-width: 200px;*/
    }

    .rideshare {
      width: 100%;
      box-sizing: border-box;
      padding: 20px 0px 35px 0px;
      border-top: 2px dotted rgba(255,255,255,0.15);
      border-bottom: 2px dotted rgba(255,255,255,0.15);
      @apply(--layout-vertical);
      @apply(--layout-center-center);
    }

    .rideshare h2 {
      font-size: 18px;
      line-height: 20px;
      @apply(--montserrat-semibold);
    }

    .rideshare p {
      font-size: 14px;
      color: rgba(255,255,255,0.35);
    }

    .maximumsize {
      max-width: 400px;
    }

/*    .messages {
      height: 25vh;
      overflow: hidden;
    }*/

    .toboardwalk {
      border-top: 3px solid var(--sc-blue);
    }

    .shadowwide {

        box-shadow:
      0px 1px 19px -1px rgba(0,0,0,0.05);
        -webkit-box-shadow:
      0px 1px 19px -1px rgba(0,0,0,0.05);
        -moz-box-shadow:
      0px 1px 19px -1px rgba(0,0,0,0.05);
        -o-box-shadow:
      0px 1px 19px -1px rgba(0,0,0,0.05);
    }


    .hashtaglistbtn {
      position: fixed;
      top: 12%;
      right: 0;
    }

    .hashtaglistbtn paper-icon-button {
      margin-right: 30px;
      z-index: 9;
    }



    .testblock {
      height: 50px;
      width: 50px;
      min-height: 50px;
      min-width: 50px;
      background-color: blue;
      margin: 10px;
    }
    .bottomhalf {
      height: 58%;
/*      border-top: 1px solid rgba(0,0,0,0.05);
*/
    }


    .notifcounter {

/*    height: 28px;
    max-width: 40%;
    min-height: 28px;
    min-width: 22px;
    border-radius: 14px;
    margin-top: 14px;
    margin-bottom: 28px;*/
    box-sizing:border-box;

    padding: 50px;
      border-top: 2px dotted rgba(0,0,0,0.15);

    }

    .notifcounter p {
    margin: 0px 5.3px 0px 5.3px;


    }


    iron-icon.smallericon {
      width: 22px;
      height: 22px;

    }







    @media all and (min-width: 0) and (max-width: 520px) { 


      .ac-avatar-box {
/*      @apply(--layout-vertical);
      @apply(--layout-center-center);*/
        width: 100%;
        box-sizing: border-box;
        padding: 15vh 0px 0vh 0px;
        margin: 0px;
/*        height: 50%;*/

      }

      .overlayer {
      border:1px solid green;
    height: 52%;
    position: fixed;
    z-index: -1;

      }


    .ac-username {
        margin: 12px 0px 16px 0px;
        -ms-flex: none;
        -webkit-flex: none;
        flex: none;
        text-align: center;
    }

      .arcbalance {
        height: 100%;
      @apply(--layout-vertical);
      @apply(--layout-center-center);
      margin: 0px 0px 72px 0px;
      }

      .tokentrans {
        width: 100%;
        margin-top: 0vh;
      }

      .homebalancebox {
        /*height: 50%;*/
        /*width: 100%;*/
        box-sizing: border-box;
        padding: 0px 0px 0px 0px;
      @apply(--layout-vertical);
      @apply(--layout-center);
      @apply(--layout-start-justified);
/*        -ms-flex: none;
        -webkit-flex: none;
        flex: none;*/
    }


      .homebalanceandavatar {
        box-sizing:border-box;
        padding: 0px;
      @apply(--layout-vertical);
      @apply(--layout-center-center);
      /*height: 56vh;*/
      }

      .bottomhalf {
/*        height: 38%;*/
      }

      .hashtaglistbtn {
        position: fixed;
        top: 5%;
        right: 0;
      }

      .hashtaglistbtn paper-icon-button {
        width: 55px;
        height: 55px;
        min-width: 55px;
        min-height: 55px;
        padding: 6px;
      }

    }


  </style>

    <ac-sizeview sizeview="{{sizeview}}"></ac-sizeview>
    <ac-wallet
        id="wallet"
        web3="[[web3]]"
        pubkey="[[pubkey]]"
        updating="{{balanceupdating}}"
        arcbalance="{{arcbalance}}"
        ethbalance="{{ethbalance}}"></ac-wallet>
      <div class="total overflower">

  <div class="totalwidth vertic startjust center basestructure">

<!--     <div class="topbar grey1back">
      <span class="flex"></span>
      <iron-icon class="grey3" icon="sc-icons:decline" on-tap="toHashtaglist">back</iron-icon>
    </div>
 -->
<!--     <div class="totalwidth horizont center endjust hashtaglistbtn">
      <div class="borderbehindbtn"></div>
      <paper-icon-button class="big whiteback blue shadow" icon="sc-icons:hashtagbolder" on-tap="toHashtaglist" noink></paper-icon-button>
    </div> -->


    <div class="totalwidth homebalanceandavatar">

      <div class="ac-avatar-box">
        <ac-avatar
        on-tap="toProfile"
        identity="[[identity]]"
        pubkey="[[pubkey]]"
        id="homeavatar"
        ></ac-avatar>

          <ac-avatar
          identity="[[identity]]"
          pubkey="[[pubkey]]"
          mode="txtonly"
          id="avatarusername"
          class="ac-username">
          </ac-avatar>
      </div>

      <div class="homebalancebox" id="homebalance">


        <template is="dom-if" if="{{!balanceupdating}}">
          <div class="arcbalance" on-tap="toWalletview">
            <ac-balance
          refcur="EUR"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}"
          on-refresh="monitorBalance"
          ></ac-balance>
          </div>
        </template>

        <template is="dom-if" if="{{balanceupdating}}">
          <div class$="arcbalance {{arcalign}}">
            <ac-spinner big></ac-spinner>
          </div>
        </template>

      </div>

<!--     <div class="notifcounter totalwidth blue centertxt horizont centercenter">
      <p class="bold">4 </p><iron-icon icon="sc-icons:babble" class="blue smallericon"></iron-icon>
    </div> -->

    </div>




        <div id="bottomhalf" class="bottomhalf totalwidth vertic start startjust whiteback">
          <sc-hashtaglist
          on-hashtag="toHashtag"></sc-hashtaglist>
          <div class="whitespace"></div>
          <div class="whitespace"></div>
          <div class="whitespace"></div>
    <!--       <sc-notification
            identity="[[identity]]"
            pubkey="[[account]]"
            msg="You created a new offer"
            offer="From Antwerp Meir to Marnixplaats, Antwerpen"
            cat="rideshare">
          </sc-notification>

          <sc-notification
            identity="[[identity]]"
            pubkey="[[account]]"
            msg="You reacted to "
            offer="From Lange Leemstraat 221, Antwerp to Nieuwe Donk 28, Deurne"
            cat="rideshare">
          </sc-notification> -->
        <div>
      </div>
    </div>


  </div>

  </div>

</template>

<script>
  Polymer({
    is: 'ac-home',
    properties: {
      identity: {
        type: String,
        observer: '_identity',
        notify: true
      },
      datachanged: {
        type: Boolean,
        value: false
      },

      web3: {
        type: Object
      },

      keystore: {
        type: Object,
         observer: '_keystore',
      },
      sizeview: {
        type: String,
        observer: '_sizeview'
      },


      pubkey: {
        type: String,
        observer: '_pubkey'
      },

      sharedElements: {
        type: Object,
        value: function() {
          return {
            'hero': '',
          }
        }
      },

      animationConfig: {
        // type: Object,
        // value: function() {
        //   return {
        //     'entry': [{
        //       name: 'fade-in-animation',
        //       node:this.$.homebalance,
        //       toPage: this,
        //       timing: {
        //         duration: 200
        //       }
        //     // }, {
        //     //   name: 'fade-in-animation',
        //     //   node:this.$.avatarusername,
        //     //   fromPage: this,
        //     //   timing: {
        //     //       duration: 200
        //     //   }
        //     },{
        //       name: 'hero-animation',
        //       id: 'hero',
        //       toPage: this,
        //       timing: {
        //           duration: 200
        //       }
        //     }],

        //     'exit': [{
        //       name: 'fade-out-animation',
        //       node:this.$.homebalance,
        //       fromPage: this,
        //       timing: {
        //           duration: 200
        //       }
        //     // }, {
        //     //   name: 'fade-out-animation',
        //     //   node:this.$.avatarusername,
        //     //   fromPage: this,
        //     //   timing: {
        //     //       duration: 200
        //     //   }
        //     },{
        //       name: 'hero-animation',
        //       id: 'hero',
        //       fromPage: this,
        //       timing: {
        //           duration: 200
        //       }
        //     }]
        //   }
        // },
      }

    },


    behaviors: [
      Polymer.NeonSharedElementAnimatableBehavior
    ],

    _pubkey: function(){
      if (this.pubkey){
        this.$.wallet.updateBalance();
      }
    },

    _keystore: function(){
      //debugger;
    },

    monitorBalance: function(){
      this.$.wallet.monitorBalance();
    },


    ready: function() {
      this.datastate = 'view';
    },

    init: function(cb){
      this.username = this.identity.username;
      this.avatarhash = this.identity.avatarhash;
      if (cb) cb();
    },
    attached: function(){
      console.log('pubkey',this.pubkey);
    },

    uploadfile: function() {
      document.querySelector('#avatarupload').click();
    },

    usernameChange: function() {
      this.identity.username = this.username;
      // this.datachanged = true;
    },

    avatarChange: function(e) {
      var input = e.target;
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          this.toCropper(e.target.result);
        }.bind(this);
        reader.readAsDataURL(input.files[0]);
      }
    },

    _is: function(a, b) {
      if (b === undefined) {
        b = true;
      }
      return a === b;
    },

    // receive identity from data binder
    _identity: function() {
      if (this.identity){
        this.currentavatar = this.identity.avatarurl;
      }
    },

    toCropper: function(image) {
      this.datastate = 'edit';
      this.currentavatar = image;
      if (this.croppie && this.croppie.destroy) {
        this.croppie.destroy();
      }
      this.croppie = new Croppie(this.$.croppie, {
        viewport: {
          width: 100,
          height: 100,
          type: 'circle'
        },
        boundary: {
          width: 200,
          height: 200
        },
        showZoomer: false
          //enableOrientation: true
      });
      this.croppie.bind({
        url: image,
        orientation: 4
      });
    },

    setcurrentavatar_cancel: function() {
      this.datastate = 'view';
      self.croppie.destroy();
    },

    setcurrentavatar: function() {
      var self = this;
      this.croppie.result({
        type: 'base64',
        format: 'jpeg',
        quality: 0.9
      }).then(function(base64) {

        // set the avatar to the dataURL.
        this.currentavatar = base64;
        this.datastate = 'view';

        // now convert and save to IPFS in the background.
        var base64data = base64.replace(/^data:image\/(png|jpg|jpeg);base64,/, '');
        var imgbuffer = this.$.ipfs.ipfs.Buffer(base64data, 'base64');

        this.$.ipfs.add(imgbuffer, function(err, result) {
          console.log(err, result[0].hash);
          var hashurl = this.$.ipfs.geturl(result[0].hash);
          self.identity.avatarurl = hashurl;
          self.datachanged = true;
          self.fire('identity-update',self.identity);
        }.bind(this));

        // remove cropper
        self.croppie.destroy();
        self.datachanged = true;

      }.bind(this));

    },


//    logout: function() {
//      this.fire('logout');
//      sessionStorage.removeItem('ac-password');
//      window.location = '/';
//    },

    _username: function(newVal,oldVal) {
      if (oldVal!==undefined){
        this.datachanged = true;
      }
      //console.log(this.username);
      // if (this.username != this.identity.username) {
      //   var collapser = document.getElementById('collapse');
      //   collapser.show();
      // }
      // if (this.username == this.identity.username) {
      //   var collapser = document.getElementById('collapse');
      //   collapser.hide();
      // }
    },

    // exit: function(){
    //   this.datastate = 'view';
    //   this.datachanged = false;
    //   this.fire('exit');
    // },



    confirm: function() {
      this.set('identity.username', this.username);
      this.datachanged = false;
      this.fire('identity-update',this.identity);
      // this.fire('exit');
    },

    close: function() {
      this.datachanged = false;
    },

    _datachanged: function() {
      // console.log('joooo');
    },

    toHashtag: function(e) {

      this.sharedElements = {
          'hero': this.$.homeavatar,
          'balance': this.$.homebalance
        };

      this.animationConfig = {
          'entry': [{
              name: 'fade-in-animation',
              node:this.$.homebalance,
              toPage: this,
              timing: {
                delay: 200,
                duration: 125
              }
            },{
              name: 'fade-in-animation',
              node:this.$.avatarusername,
              toPage: this,
              timing: {
                delay: 475,
                duration: 125
              }
            }, {
              name: 'slide-from-bottom-animation',
              node:this.$.bottomhalf,
              toPage: this,
              timing: {
                duration: 700
              }
            },{
              name: 'hero-animation',
              id: 'hero',
              toPage: this,
              timing: {
                  duration: 500
              }
            },{
              name: 'hero-animation',
              id: 'balance',
              toPage: this,
              timing: {
                  duration: 500
              }
            }],

            'exit': [
            // {
            //   name: 'fade-out-animation',
            //   node:this.$.homebalance,
            //   fromPage: this,
            //   timing: {
            //       duration: 200
            //   }
            // }, 
            {
              name: 'fade-out-animation',
              node:this.$.avatarusername,
              fromPage: this,
              timing: {
                  duration: 200
              }
            }, {
              name: 'fade-out-animation',
              node:this.$.bottomhalf,
              fromPage: this,
              timing: {
                  duration: 200
              }
            },{
              name: 'hero-animation',
              id: 'hero',
              fromPage: this,
              timing: {
                  duration: 500
              }
            },{
              name: 'hero-animation',
              id: 'balance',
              fromPage: this,
              timing: {
                  duration: 500
              }
            }]
        };

      console.log(" ********* komtiieeeee!!",e.detail)
      this.fire('to-hashtag',e.detail);
    },


    toProfile: function() {
      this.sharedElements = {
          'hero': this.$.homeavatar,
          'hero2': this.$.avatarusername
        };

      this.animationConfig = {
            'entry': [{
              name: 'fade-in-animation',
              node:this.$.homebalance,
              toPage: this,
              timing: {
                delay: 200,
                duration: 125
              },

            }, {
              name: 'slide-from-bottom-animation',
              node:this.$.bottomhalf,
              toPage: this,
              timing: {
                duration: 700
              }
            },{
              name: 'hero-animation',
              id: 'hero',
              toPage: this,
              timing: {
                  duration: 600
                }
              // },{
              // name: 'hero-animation',
              // id: 'hero2',
              // toPage: this,
              // timing: {
              //     duration: 600
              // }
            // },{
            //   name: 'hero-animation',
            //   id: 'hero3',
            //   toPage: this,
            //   timing: {
            //       duration: 600
            //   }
            }],

            'exit': [{
              name: 'fade-out-animation',
              node:this.$.homebalance,
              fromPage: this,
              timing: {
                  duration: 125
              }
            },{
              name: 'fade-out-animation',
              node:this.$.avatarusername,
              fromPage: this,
              timing: {
                  duration: 125
              }
            }, {
              name: 'slide-down-animation',
              node:this.$.bottomhalf,
              fromPage: this,
              timing: {
                  duration: 700
              }
            },{
              name: 'hero-animation',
              id: 'hero',
              fromPage: this,
              timing: {
                  duration: 600
                }
              // },{
              // name: 'hero-animation',
              // id: 'hero2',
              // fromPage: this,
              // timing: {
              //     duration: 600
              //   }
              // },{
              // name: 'hero-animation',
              // id: 'hero3',
              // fromPage: this,
              // timing: {
              //     duration: 600
              // }
            }]
        };


      this.fire('to-profile');
    },

    toWalletview: function() {

      // TODO : remove this
      return;

      this.sharedElements = {
        'hero': this.$.homebalance,
        };
      this.animationConfig = {
            'entry': [{
              name: 'fade-in-animation',
              node:this.$.homebalance,
              toPage: this,
              timing: {
                duration: 200
              }
            }, {
              name: 'fade-in-animation',
              node:this.$.avatarusername,
              toPage: this,
              timing: {
                duration: 200
              }
            },{
              name: 'hero-animation',
              id: 'hero',
              toPage: this,
              timing: {
                  duration: 600
              }
            }],

            'exit': [{
              name: 'fade-out-animation',
              node:this.$.homebalance,
              fromPage: this,
              timing: {
                  duration: 200
              }
            }, {
              name: 'fade-out-animation',
              node:this.$.avatarusername,
              fromPage: this,
              timing: {
                  duration: 200
              }
            },{
              name: 'hero-animation',
              id: 'hero',
              fromPage: this,
              timing: {
                  duration: 600
              }
            }]
        };
      this.fire('to-walletview');
    },

      _sizeview: function() {
        // switch (this.sizeview) {
        //   case 'phone':
        //     this.updateStyles();
        //     break;
        //   case 'desktop':
        //     this.updateStyles();
        //     break;
        //   case 'xlarge':
        //     this.updateStyles();
        //     break;
        //   default:
        //     console.log("!!! ** Niks");
        // }
      },

    _checkAnimconfig: function() {
      // console.log('joooo, dit is de Animconfig', this.animationConfig);
    },

    // savenewUsername: function() {
    //   var collapser = document.getElementById('collapse');
    //   console.log("this is it", collapser);
    //   collapser.toggle();
    // },

    // backtohome: function() {
    //   this.datastate = 'view';
    //   this.fire('exit');
    // },

    // toggleupload: function() {
    //   this.$.ipfsupload.click();
    // }

  });
</script>

</dom-module>